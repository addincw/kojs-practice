<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Single Page Application | Knockout JS Practice</title>
    <link rel="stylesheet" href="/assets/css/single-page-application.css" />
  </head>
  <body>
    <ul class="folders" data-bind="foreach: folders">
      <li
        data-bind="text: $data, css: { selected: $data == $root.folderSelected() }, click: $root.goToFolder"
      ></li>
    </ul>

    <main data-bind="with: folderSelectedData">
      <h1 data-bind="text: `${id} (${mails.length})`"></h1>

      <!-- Mails grid -->
      <table class="mails">
        <thead>
          <tr>
            <th>From</th>
            <th>To</th>
            <th>Subject</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody data-bind="foreach: mails">
          <tr>
            <td data-bind="text: from"></td>
            <td data-bind="text: to"></td>
            <td data-bind="text: subject"></td>
            <td data-bind="text: date"></td>
          </tr>
        </tbody>
      </table>
    </main>

    <script src="/assets/knockout-3.5.1.js"></script>
    <script type="text/javascript">
      function WebmailViewModel() {
        var self = this;

        self.folders = ["Inbox", "Archive", "Sent", "Spam"];

        self.folderSelected = ko.observable();
        self.folderSelectedData = ko.observable();

        self.goToFolder = function (folder) {
          if (self.folderSelected() === folder) return;

          self.folderSelected(folder);

          fetch("https://658506d7022766bcb8c7c89d.mockapi.io/api/v1/mails")
            .then((response) => response.json())
            .then(function (data) {
              self.folderSelectedData({
                id: folder,
                mails: data,
              });
            });
        };

        self.goToFolder("Inbox");
      }

      ko.applyBindings(new WebmailViewModel());
    </script>
  </body>
</html>
